/** * @license * Copyright Google LLC All Rights Reserved. * * Use of this source code is governed by an MIT-style license that can be * found in the LICENSE file at https://angular.io/license */import {Xliff2} from '@angular/compiler/src/i18n/serializers/xliff2';import {waitForAsync} from '@angular/core/testing';import {expect} from '@angular/platform-browser/testing/src/matchers';import {configureCompiler, createComponent, HTML, serializeTranslations, validateHtml} from './integration_common';// TODO(alxhub): figure out if this test is still relevant.xdescribe('i18n XLIFF integration spec', () => {  describe('(with LF line endings)', () => {    beforeEach(waitForAsync(> configureCompiler(XLIFF2_TOMERGE + LF_LINE_ENDING_XLIFF2_TOMERGE, 'xlf2')));    it('should extract from templates', () => {serializer = new Xliff2();serializedXliff2 = serializeTranslations(HTML, serializer);_EXTRACTED.forEach(x => {ct(serializedXliff2).toContain(x);(serializedXliff2).toContain(LF_LINE_ENDING_XLIFF2_EXTRACTED);    });    it('should translate templates', () => {{tb, cmp, el} = createComponent(HTML);teHtml(tb, cmp, el);    });  });  describe('(with CRLF line endings', () => {    beforeEach(waitForAsync(> configureCompiler(XLIFF2_TOMERGE + CRLF_LINE_ENDING_XLIFF2_TOMERGE, 'xlf2')));    it('should extract from templates (with CRLF line endings)', () => {serializer = new Xliff2();serializedXliff = serializeTranslations(HTML.replace(/\n/g, '\r\n'), serializer);_EXTRACTED.forEach(x => {ct(serializedXliff).toContain(x);(serializedXliff).toContain(CRLF_LINE_ENDING_XLIFF2_EXTRACTED);    });    it('should translate templates (with CRLF line endings)', () => {{tb, cmp, el} = createComponent(HTML.replace(/\n/g, '\r\n'));teHtml(tb, cmp, el);    });  });});const XLIFF2_TOMERGE = `id="615790887472569365">nt>rce>i18n attribute on tags</source>get>attributs i18n sur les balises</target>ent>    </unit>    <unit id="3707494640264351337">nt>rce>nested</source>get>imbriqué</target>ent>    </unit>    <unit id="5539162898278769904">nt>rce>nested</source>get>imbriqué</target>ent>    </unit>    <unit id="3780349238193953556">nt>rce><pc id="0" equivStart="START_ITALIC_TEXT" equivEnd="CLOSE_ITALIC_TEXT" type="fmt" dispStart="&lt;i&gt;" dispEnd="&lt;/i&gt;">with placeholders</pc></source>get><pc id="0" equivStart="START_ITALIC_TEXT" equivEnd="CLOSE_ITALIC_TEXT" type="fmt" dispStart="&lt;i&gt;" dispEnd="&lt;/i&gt;">avec des espaces réservés</pc></target>ent>    </unit>    <unit id="5415448997399451992">>e category="location">file.ts:11</note>s>nt>rce><pc id="0" equivStart="START_TAG_DIV" equivEnd="CLOSE_TAG_DIV" type="other" dispStart="&lt;div&gt;" dispEnd="&lt;/div&gt;">with <pc id="1" equivStart="START_TAG_DIV" equivEnd="CLOSE_TAG_DIV" type="other" dispStart="&lt;div&gt;" dispEnd="&lt;/div&gt;">nested</pc> placeholders</pc></source>get><pc id="0" equivStart="START_TAG_DIV" equivEnd="CLOSE_TAG_DIV" type="other" dispStart="&lt;div&gt;" dispEnd="&lt;/div&gt;">avec <pc id="1" equivStart="START_TAG_DIV" equivEnd="CLOSE_TAG_DIV" type="other" dispStart="&lt;div&gt;" dispEnd="&lt;/div&gt;">espaces réservés</pc> imbriqués</pc></target>ent>    </unit>    <unit id="5525133077318024839">nt>rce>on not translatable node</source>get>sur des balises non traductibles</target>ent>    </unit>    <unit id="2174788525135228764">nt>rce>&lt;b&gt;bold&lt;/b&gt;</source>get>&lt;b&gt;gras&lt;/b&gt;</target>ent>    </unit>    <unit id="8670732454866344690">nt>rce>on translatable node</source>get>sur des balises traductibles</target>ent>    </unit>    <unit id="4593805537723189714">nt>rce>{VAR_PLURAL, plural, =0 {zero} =1 {one} =2 {two} other {<pc id="0" equivStart="START_BOLD_TEXT" equivEnd="CLOSE_BOLD_TEXT" type="fmt" dispStart="&lt;b&gt;" dispEnd="&lt;/b&gt;">many</pc>} }</source>get>{VAR_PLURAL, plural, =0 {zero} =1 {un} =2 {deux} other {<pc id="0" equivStart="START_BOLD_TEXT" equivEnd="CLOSE_BOLD_TEXT" type="fmt" dispStart="&lt;b&gt;" dispEnd="&lt;/b&gt;">beaucoup</pc>} }</target>ent>    </unit>    <unit id="703464324060964421">nt>rce>id="0" equiv="ICU" disp="{sex, select, other {...} male {...} female {...}}"/>    </source>get><ph id="0" equiv="ICU" disp="{sex, select, other {...} male {...} female {...}}"/></target>ent>    </unit>    <unit id="5430374139308914421">>e category="location">file.ts:23</note>s>nt>rce>{VAR_SELECT, select, other {other} male {m} female {female} }</source>get>{VAR_SELECT, select, other {autre} male {homme} female {femme} }</target>ent>    </unit>    <unit id="1300564767229037107">>e category="location">file.ts:25,27</note>s>nt>rce>id="0" equiv="ICU" disp="{sexB, select, male {...} female {...}}"/>    </source>t><ph id="0" equiv="ICU" disp="{sexB, select, male {...} female {...}}"/></target>ent>    </unit>    <unit id="2500580913783245106">nt>rce>{VAR_SELECT, select, male {m} female {f} }</source>get>{VAR_SELECT, select, male {homme} female {femme} }</target>ent>    </unit>    <unit id="4851788426695310455">nt>rce><ph id="0" equiv="INTERPOLATION" disp="{{ &quot;count = &quot; + count }}"/></source>get><ph id="0" equiv="INTERPOLATION" disp="{{ &quot;count = &quot; + count }}"/></target>ent>    </unit>    <unit id="9013357158046221374">nt>rce>sex = <ph id="0" equiv="INTERPOLATION" disp="{{ sex }}"/></source>get>sexe = <ph id="0" equiv="INTERPOLATION" disp="{{ sex }}"/></target>ent>    </unit>    <unit id="8324617391167353662">nt>rce><ph id="0" equiv="CUSTOM_NAME" disp="{{ &quot;custom name&quot; //i18n(ph=&quot;CUSTOM_NAME&quot;) }}"/></source>get><ph id="0" equiv="CUSTOM_NAME" disp="{{ &quot;custom name&quot; //i18n(ph=&quot;CUSTOM_NAME&quot;) }}"/></target>ent>    </unit>    <unit id="7685649297917455806">nt>rce>in a translatable section</source>get>dans une section traductible</target>ent>    </unit>    <unit id="2329001734457059408">nt>rce>    <pc id="0" equivStart="START_HEADING_LEVEL1" equivEnd="CLOSE_HEADING_LEVEL1" type="other" dispStart="&lt;h1&gt;" dispEnd="&lt;/h1&gt;">Markers in html comments</pc>    <pc id="1" equivStart="START_TAG_DIV" equivEnd="CLOSE_TAG_DIV" type="other" dispStart="&lt;div&gt;" dispEnd="&lt;/div&gt;"></pc>    <pc id="2" equivStart="START_TAG_DIV_1" equivEnd="CLOSE_TAG_DIV" type="other" dispStart="&lt;div&gt;" dispEnd="&lt;/div&gt;"><ph id="3" equiv="ICU" disp="{count, plural, =0 {...} =1 {...} =2 {...} other {...}}"/></pc></source>get>    <pc id="0" equivStart="START_HEADING_LEVEL1" equivEnd="CLOSE_HEADING_LEVEL1" type="other" dispStart="&lt;h1&gt;" dispEnd="&lt;/h1&gt;">Balises dans les commentaires html</pc>    <pc id="1" equivStart="START_TAG_DIV" equivEnd="CLOSE_TAG_DIV" type="other" dispStart="&lt;div&gt;" dispEnd="&lt;/div&gt;"></pc>    <pc id="2" equivStart="START_TAG_DIV_1" equivEnd="CLOSE_TAG_DIV" type="other" dispStart="&lt;div&gt;" dispEnd="&lt;/div&gt;"><ph id="3" equiv="ICU" disp="{count, plural, =0 {...} =1 {...} =2 {...} other {...}}"/></pc></target>ent>    </unit>    <unit id="1491627405349178954">nt>rce>it <pc id="0" equivStart="START_BOLD_TEXT" equivEnd="CLOSE_BOLD_TEXT" type="fmt" dispStart="&lt;b&gt;" dispEnd="&lt;/b&gt;">should</pc> work</source>get>ca <pc id="0" equivStart="START_BOLD_TEXT" equivEnd="CLOSE_BOLD_TEXT" type="fmt" dispStart="&lt;b&gt;" dispEnd="&lt;/b&gt;">devrait</pc> marcher</target>ent>    </unit>    <unit id="i18n16">nt>rce>with an explicit ID</source>get>avec un ID explicite</target>ent>    </unit>    <unit id="i18n17">nt>rce>{VAR_PLURAL, plural, =0 {zero} =1 {one} =2 {two} other {<pc id="0" equivStart="START_BOLD_TEXT" equivEnd="CLOSE_BOLD_TEXT" type="fmt" dispStart="&lt;b&gt;" dispEnd="&lt;/b&gt;">many</pc>} }</source>get>{VAR_PLURAL, plural, =0 {zero} =1 {un} =2 {deux} other {<pc id="0" equivStart="START_BOLD_TEXT" equivEnd="CLOSE_BOLD_TEXT" type="fmt" dispStart="&lt;b&gt;" dispEnd="&lt;/b&gt;">beaucoup</pc>} }</target>ent>    </unit>    <unit id="4035252431381981115">nt>rce>foo<pc id="0" equivStart="START_LINK" equivEnd="CLOSE_LINK" type="link" dispStart="&lt;a&gt;" dispEnd="&lt;/a&gt;">bar</pc></source>get>FOO<pc id="0" equivStart="START_LINK" equivEnd="CLOSE_LINK" type="link" dispStart="&lt;a&gt;" dispEnd="&lt;/a&gt;">BAR</pc></target>ent>    </unit>    <unit id="5339604010413301604">nt>rce><ph id="0" equiv="MAP NAME" disp="{{ &apos;test&apos; //i18n(ph=&quot;map name&quot;) }}"/></source>get><ph id="0" equiv="MAP NAME" disp="{{ &apos;test&apos; //i18n(ph=&quot;map name&quot;) }}"/></target>ent>    </unit>`;const LF_LINE_ENDING_XLIFF2_TOMERGE = `    <unit id="4085484936881858615">nt>rce>{VAR_PLURAL, plural, =0 {Found no results} =1 {Found one result} other {Found <ph id="0" equiv="INTERPOLATION" disp="{{response.getItemsList().length}}"/> results} }</source>get>{VAR_PLURAL, plural, =0 {Pas de réponse} =1 {Une réponse} other {<ph id="0" equiv="INTERPOLATION" disp="{{response.getItemsList().length}}"/> réponses} }</target>ent>    </unit>`;const CRLF_LINE_ENDING_XLIFF2_TOMERGE = `    <unit id="4085484936881858615">nt>rce>{VAR_PLURAL, plural, =0 {Found no results} =1 {Found one result} other {Found <ph id="0" equiv="INTERPOLATION" disp="{{response.getItemsList().length}}"/> results} }</source>get>{VAR_PLURAL, plural, =0 {Pas de réponse} =1 {Une réponse} other {<ph id="0" equiv="INTERPOLATION" disp="{{response.getItemsList().length}}"/> réponses} }</target>ent>    </unit>`;const XLIFF2_EXTRACTED = [  `    <unit id="615790887472569365">>e category="location">file.ts:3</note>s>nt>rce>i18n attribute on tags</source>ent>    </unit>`,  `    <unit id="3707494640264351337">>e category="location">file.ts:5</note>s>nt>rce>nested</source>ent>    </unit>`,  `    <unit id="5539162898278769904">>e category="meaning">different meaning</note>e category="location">file.ts:7</note>s>nt>rce>nested</source>ent>    </unit>`,  `    <unit id="3780349238193953556">>e category="location">file.ts:9</note>e category="location">file.ts:10</note>s>nt>rce><pc id="0" equivStart="START_ITALIC_TEXT" equivEnd="CLOSE_ITALIC_TEXT" type="fmt" dispStart="&lt;i&gt;" dispEnd="&lt;/i&gt;">with placeholders</pc></source>ent>    </unit>`,  `    <unit id="5415448997399451992">>e category="location">file.ts:11</note>s>nt>rce><pc id="0" equivStart="START_TAG_DIV" equivEnd="CLOSE_TAG_DIV" type="other" dispStart="&lt;div&gt;" dispEnd="&lt;/div&gt;">with <pc id="1" equivStart="START_TAG_DIV" equivEnd="CLOSE_TAG_DIV" type="other" dispStart="&lt;div&gt;" dispEnd="&lt;/div&gt;">nested</pc> placeholders</pc></source>ent>    </unit>`,  `    <unit id="5525133077318024839">>e category="location">file.ts:14</note>s>nt>rce>on not translatable node</source>ent>    </unit>`,  `    <unit id="2174788525135228764">>e category="location">file.ts:14</note>s>nt>rce>&lt;b&gt;bold&lt;/b&gt;</source>ent>    </unit>`,  `    <unit id="8670732454866344690">>e category="location">file.ts:15</note>s>nt>rce>on translatable node</source>ent>    </unit>`,  `    <unit id="4593805537723189714">>e category="location">file.ts:20</note>e category="location">file.ts:37</note>s>nt>rce>{VAR_PLURAL, plural, =0 {zero} =1 {one} =2 {two} other {<pc id="0" equivStart="START_BOLD_TEXT" equivEnd="CLOSE_BOLD_TEXT" type="fmt" dispStart="&lt;b&gt;" dispEnd="&lt;/b&gt;">many</pc>} }</source>ent>    </unit>`,  `    <unit id="703464324060964421">>e category="location">file.ts:22,24</note>s>nt>rce>id="0" equiv="ICU" disp="{sex, select, male {...} female {...} other {...}}"/>    </source>ent>    </unit>`,  `    <unit id="5430374139308914421">>e category="location">file.ts:23</note>s>nt>rce>{VAR_SELECT, select, male {m} female {f} other {other} }</source>ent>    </unit>`,  `    <unit id="1300564767229037107">>e category="location">file.ts:25,27</note>s>nt>rce>id="0" equiv="ICU" disp="{sexB, select, male {...} female {...}}"/>    </source>ent>    </unit>`,  `    <unit id="2500580913783245106">>e category="location">file.ts:26</note>s>nt>rce>{VAR_SELECT, select, male {m} female {f} }</source>ent>    </unit>`,  `    <unit id="4851788426695310455">>e category="location">file.ts:29</note>s>nt>rce><ph id="0" equiv="INTERPOLATION" disp="{{ &quot;count = &quot; + count }}"/></source>ent>    </unit>`,  `    <unit id="9013357158046221374">>e category="location">file.ts:30</note>s>nt>rce>sex = <ph id="0" equiv="INTERPOLATION" disp="{{ sex }}"/></source>ent>    </unit>`,  `    <unit id="8324617391167353662">>e category="location">file.ts:31</note>s>nt>rce><ph id="0" equiv="CUSTOM_NAME" disp="{{ &quot;custom name&quot; //i18n(ph=&quot;CUSTOM_NAME&quot;) }}"/></source>ent>    </unit>`,  `    <unit id="7685649297917455806">>e category="location">file.ts:36</note>e category="location">file.ts:54</note>s>nt>rce>in a translatable section</source>ent>    </unit>`,  `    <unit id="2329001734457059408">>e category="location">file.ts:34,38</note>s>nt>rce>    <pc id="0" equivStart="START_HEADING_LEVEL1" equivEnd="CLOSE_HEADING_LEVEL1" type="other" dispStart="&lt;h1&gt;" dispEnd="&lt;/h1&gt;">Markers in html comments</pc>    <pc id="1" equivStart="START_TAG_DIV" equivEnd="CLOSE_TAG_DIV" type="other" dispStart="&lt;div&gt;" dispEnd="&lt;/div&gt;"></pc>    <pc id="2" equivStart="START_TAG_DIV_1" equivEnd="CLOSE_TAG_DIV" type="other" dispStart="&lt;div&gt;" dispEnd="&lt;/div&gt;"><ph id="3" equiv="ICU" disp="{count, plural, =0 {...} =1 {...} =2 {...} other {...}}"/></pc></source>ent>    </unit>`,  `    <unit id="1491627405349178954">>e category="location">file.ts:40</note>s>nt>rce>it <pc id="0" equivStart="START_BOLD_TEXT" equivEnd="CLOSE_BOLD_TEXT" type="fmt" dispStart="&lt;b&gt;" dispEnd="&lt;/b&gt;">should</pc> work</source>ent>    </unit>`,  `    <unit id="i18n16">>e category="location">file.ts:42</note>s>nt>rce>with an explicit ID</source>ent>    </unit>`,  `    <unit id="i18n17">>e category="location">file.ts:43</note>s>nt>rce>{VAR_PLURAL, plural, =0 {zero} =1 {one} =2 {two} other {<pc id="0" equivStart="START_BOLD_TEXT" equivEnd="CLOSE_BOLD_TEXT" type="fmt" dispStart="&lt;b&gt;" dispEnd="&lt;/b&gt;">many</pc>} }</source>ent>    </unit>`,  `    <unit id="4035252431381981115">>e category="location">file.ts:54</note>s>nt>rce>foo<pc id="0" equivStart="START_LINK" equivEnd="CLOSE_LINK" type="link" dispStart="&lt;a&gt;" dispEnd="&lt;/a&gt;">bar</pc></source>ent>    </unit>`,  `    <unit id="5339604010413301604">>e category="location">file.ts:56</note>s>nt>rce><ph id="0" equiv="MAP NAME" disp="{{ &apos;test&apos; //i18n(ph=&quot;map name&quot;) }}"/></source>ent>    </unit>`];const LF_LINE_ENDING_XLIFF2_EXTRACTED = `    <unit id="4085484936881858615">>e category="description">desc</note>e category="location">file.ts:46,52</note>s>nt>rce>{VAR_PLURAL, plural, =0 {Found no results} =1 {Found one result} other {Found <ph id="0" equiv="INTERPOLATION" disp="{{response.getItemsList().length}}"/> results} }</source>ent>    </unit>`;const CRLF_LINE_ENDING_XLIFF2_EXTRACTED = `    <unit id="4085484936881858615">>e category="description">desc</note>e category="location">file.ts:46,52</note>s>nt>rce>{VAR_PLURAL, plural, =0 {Found no results} =1 {Found one result} other {Found <ph id="0" equiv="INTERPOLATION" disp="{{response.getItemsList().length}}"/> results} }</source>ent>    </unit>`;